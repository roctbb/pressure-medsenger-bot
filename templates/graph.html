<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Графики измерений</title>
</head>
    <!-- Resources -->

    <script src="https://www.amcharts.com/lib/4/core.js"></script>
    <script src="https://www.amcharts.com/lib/4/charts.js"></script>
    <script src="https://www.amcharts.com/lib/4/lang/ru_RU.js"></script>
    <script src="https://www.amcharts.com/lib/4/lang/en_US.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/dark.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
<body>
    <!-- Styles -->

    <style >
        @import url("https://fonts.googleapis.com/css?family=Archivo+Narrow");

        html, body {
            height: 100%;
        }

        body {
            font-family: "Tahoma", "Archivo Narrow";
        }

        .height-530 {
            height: 530px;
        }

        .dark {
            {#background-color: #30303d; color: #fff;#}
        }

        .transparant {
            background-color: transparent;
        }

        .chartdiv {
            margin-top: 1rem;
            width: 100%;
        }

        .chartdiv-light {
            margin-top: 1rem;
            width: 100%;
            height: 530px;
        }

        .shown {
            display: block;
        }

        .hidden {
            display: none;
        }

        .w100 {
            width: 99%;
            margin: 2px;
        }

        #medicine:hover, #measurement:hover {
            cursor: pointer;
        }

        .active-btn {
            background-color: #cccccc;
            color: antiquewhite;
        }

        .btn {
            {#padding: 7px;#}
            {#margin-bottom: 3px;#}
            {#border: 1px solid lightseagreen;#}
        }

        .btn:hover {
            cursor: pointer;
        }

        .shown {
            display: block;
        }

        .hidden {
            display: none;
        }

    </style>

    <style>
        #sys-stat-week, #sys-stat-month, #sys-stat-donat, #dia-stat-donat, #dia-stat-week, #dia-stat-month {
            width: 100%;
            {#height: 250px;#}
            text-align: center;
        }

        highcharts-figure, .highcharts-data-table table {
            min-width: 310px;
            max-width: 800px;
            margin: 1em auto;
        }

        .highcharts-data-table table {
            {#font-family: Verdana, sans-serif;#}
            border-collapse: collapse;
            border: 1px solid #EBEBEB;
            margin: 10px auto;
            text-align: center;
            width: 100%;
            max-width: 500px;
        }
        .highcharts-data-table caption {
            padding: 1em 0;
            font-size: 1.2em;
            color: #555;
        }
        .highcharts-data-table th {
            font-weight: 600;
            padding: 0.5em;
        }
        .highcharts-data-table td, .highcharts-data-table th, .highcharts-data-table caption {
            padding: 0.5em;
        }
        .highcharts-data-table thead tr, .highcharts-data-table tr:nth-child(even) {
            background: #f8f8f8;
        }
        .highcharts-data-table tr:hover {
            background: #f1f7ff;
        }

        .font-base {
            font-family: "Lucinda Grande", "Lucinda Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
        }

        .row {

            display: flex;
            text-align: center;

        }

        .row_cell {

            flex: 1;
            {#font-family: "Lucinda Grande", "Lucinda Sans Unicode", Helvetica, Arial, Verdana, sans-serif;#}
            font-size: 1rem;
        }

        .bold {
            font-size: 3rem;
        }

        .item-left {
            text-align: left;
        }

        .item-center {
            text-align: center;
        }

        .dark-green {
            color: #0b5975;
        }

        .item-border {
            border: 1px solid #ccc; padding: 2px;
        }
    </style>

    <style>
        body {
            font: 90%/160% Arial, Helvetica, sans-serif;
            color: #666;
            width: 900px;
            max-width: 96%;
            margin: 0 auto;
        }
        p {
            margin: 0 0 20px;
        }
        a {
            color: #69C;
            text-decoration: none;
        }
        a:hover {
            color: #F60;
        }
        h1, h2, h3 {
            color: #000;
            line-height: 120%;
            margin: 30px 0 10px;
        }
        h1 {
            font-size: 1.7em;
            color: #000;
        }
        h2 {
            font-size: 1.4em;
            border-top: solid 1px #eee;
            padding-top: 20px;
        }
        h3 {
            font-size: 1.1em;
        }

        /* nav */
        .nav {
            z-index: 100;
            margin: 20px 0;
        }
        .nav ul {
            margin: 0;
            padding: 0;
        }
        .nav li {
            margin: 0 5px 10px 0;
            padding: 0;
            list-style: none;
            display: inline-block;
            *display:inline; /* ie7 */
        }
        .nav a {
            padding: 3px 12px;
            text-decoration: none;
            color: #999;
            line-height: 100%;
        }
        .nav a:hover {
            color: #000;
            cursor: pointer;
        }
        .nav .current a {
            background: #999;
            color: #fff;
            border-radius: 5px;
        }

        /* right nav */
        .nav.right ul {
            text-align: right;
        }

        /* center nav */
        .nav.center ul {
            text-align: center;
        }

        @media screen and (max-width: 600px) {
            .nav {
                position: relative;
                min-height: 40px;
            }
            .nav ul {
                width: 300px;
                padding: 5px 0;
                position: absolute;
                top: 0;
                left: 0;
                border: solid 1px #aaa;
                background: #fff url(https://webdesignerwall.com/demo/responsive-menu/images/icon-menu.png) no-repeat 10px 11px;
                border-radius: 5px;
                box-shadow: 0 1px 2px rgba(0,0,0,.3);
            }
            .nav li {
                display: none; /* hide all <li> items */
                margin: 0;
            }
            .nav .current {
                display: block; /* show only current <li> item */
            }
            .nav a {
                display: block;
                padding: 5px 5px 5px 32px;
                text-align: left;
            }
            .nav .current a {
                background: none;
                color: #666;
            }

            /* on nav hover */
            .nav ul:hover {
                background-image: none;
            }
            .nav ul:hover li {
                display: block;
                margin: 0 0 5px;
            }
            .nav ul:hover .current {
                background: url(https://webdesignerwall.com/demo/responsive-menu/images/icon-check.png) no-repeat 10px 7px;
            }

            /* right nav */
            .nav.right ul {
                left: auto;
                right: 0;
            }

            /* center nav */
            .nav.center ul {
                left: 50%;
                margin-left: -90px;
            }
        }
</style>

    <!-- HTML -->

    <nav class="nav">
		<ul>
            <li class="current"><a id="all_graph" href="#">Все графики</a></li>
            <li><a id="pressure_graph" href="#">График измерения давления</a></li>
            <li><a id="weight_graph" href="#">График измерения веса</a></li>
            <li><a id="glukose_graph" href="#">График уровеня глюкозы</a></li>
            <li><a id="temperature_graph" href="#">График измерения температуры</a></li>
            <li><a id="pain_button" href="#">График оценки боли</a></li>
            <li><a id="spo2_button" href="#">Насыщение крови кислородом</a></li>
            <li><a id="waist_button" href="#">Окружность талии</a></li>
            <li><a id="shin_button" href="#">Обхват голени</a></li>

		</ul>
	</nav>

    {% for msg in get_flashed_messages() %}
    <div class="flash">{{msg}}</div>
    {% endfor %}

    <div>
        <select id="theme" class="hidden">
            <option>Тема</option>
            <option value="light">Светлая</option>
            <option value="dark">Темная</option>
        </select>
    </div>

    <div id="chartdiv__" class="chartdiv height-530__ dark" style="width: 100%; height: 800px; min-height: 600px;"></div>
    <div id="chartdiv_spo2" class="chartdiv height-530 dark"></div>
    <div id="chartdiv_waist" class="chartdiv height-530 dark"></div>
    <div id="chartdiv_glukose" class="chartdiv height-530 dark"></div>
    <div id="chartdiv_weight" class="chartdiv height-530 dark"></div>
    <div id="chartdiv_temperature" class="chartdiv height-530 dark"></div>
    <div id="chartdiv_pain" class="chartdiv height-530 dark"></div>
    <div id="chartdiv_shin" class="chartdiv height-530 dark"></div>

    <!-- Chart systolic-diastolic-pulse-medicines -->
    <script>
        const all_graph = document.getElementById('all_graph')
        const pressure_graph = document.getElementById('pressure_graph')
        const weight_graph = document.getElementById('weight_graph')
        const glukose_graph = document.getElementById('glukose_graph')
        const temperature_graph = document.getElementById('temperature_graph')
        const pain_button = document.getElementById('pain_button')
        {#const stat_button = document.getElementById('stat_button')#}
        const spo2_button = document.getElementById('spo2_button')
        const waist_button = document.getElementById('waist_button')
        const shin_button = document.getElementById('shin_button')

        const chartdiv__ = document.getElementById('chartdiv__')
        const chartdiv_glukose = document.getElementById('chartdiv_glukose')
        const chartdiv_weight = document.getElementById('chartdiv_weight')
        const chartdiv_temperature = document.getElementById('chartdiv_temperature')
        const theme = document.getElementById('theme')
        const chartdiv_pain = document.getElementById('chartdiv_pain')
        const chartdiv_spo2 = document.getElementById('chartdiv_spo2')
        const chartdiv_waist = document.getElementById('chartdiv_waist')
        const chartdiv_shin = document.getElementById('chartdiv_shin')

        const allDiv = [chartdiv__, chartdiv_glukose, chartdiv_weight, chartdiv_temperature, chartdiv_pain, chartdiv_spo2, chartdiv_waist, chartdiv_shin]

        const allLinks = [all_graph, pressure_graph, weight_graph, glukose_graph, temperature_graph, pain_button, spo2_button, waist_button, shin_button]

        const activeClass = 'current'

        const toggleAll = (divEl, btnEl) => {
            Aux.hideAll(allDiv)
            Aux.show(divEl)
            Aux.removeClassAll(allLinks, activeClass)
            Aux.addClass(btnEl.parentElement, activeClass)
        }

        all_graph.addEventListener('click', (event) => {
            Aux.showAll(allDiv)
            Aux.removeClassAll(allLinks, activeClass)
            Aux.addClass(all_graph.parentElement, activeClass)
        })

        pressure_graph.addEventListener('click', (event) => {
            toggleAll(chartdiv__, pressure_graph)

        })

        weight_graph.addEventListener('click', (event) => {
            toggleAll(chartdiv_weight, weight_graph)
        })

        glukose_graph.addEventListener('click', (event) => {
            toggleAll(chartdiv_glukose, glukose_graph)
        })

        temperature_graph.addEventListener('click', (event) => {
            toggleAll(chartdiv_temperature, temperature_graph)
        })

        pain_button.addEventListener('click', (event) => {
            toggleAll(chartdiv_pain, pain_button)
        })

        {#theme.addEventListener('change', function (event) {#}
        {#    const index = theme.options.selectedIndex#}
        {##}
        {#    if (index == 1) {#}
        {#        am4core__.useTheme(am4themes_animated)#}
        {#        chartdiv__.classList.remove('dark')#}
        {#        chartdiv__.style.display = "none"#}
        {#    }#}
        {#})#}

        {#stat_button.addEventListener('click', (event) => {#}
        {#    toggleAll(stat, stat_button)#}
        {#})#}

        spo2_button.addEventListener('click', (event) => {
            toggleAll(chartdiv_spo2, spo2_button)
        })

        waist_button.addEventListener('click', (event) => {
            toggleAll(chartdiv_waist, waist_button)
        })

        shin_button.addEventListener('click', (event) => {
            toggleAll(chartdiv_shin, shin_button)
        })

        am4core__ = am4core
        am4charts__ = am4charts

        /**
         * ---------------------------------------
         * This demo was created using amCharts 4.
         *
         * For more information visit:
         * https://www.amcharts.com/
         *
         * Documentation is available at:
         * https://www.amcharts.com/docs/v4/
         * ---------------------------------------
         */

        Aux = {
            "error": (e) => {
                console.error('error', e)
            },
            "show": (el) => {
                el.classList.remove('hidden')
                el.classList.add('shown')
            },
            "hide": (el) => {
                el.classList.remove('shown')
                el.classList.add('hidden')
            },
            "addClass": (el, nameClass) => {
                el.classList.add(nameClass)
            },
            "removeClass": (el, nameClass) => {
                el.classList.remove(nameClass)
            },
            "removeClassAll": (params, nameClass) => {
                params.forEach((item) => {
                    el = item.parentElement
                    Aux.removeClass(el, nameClass)
                    {#dump(el.nodeName, nameClass)#}
                })
            },
            "showAll": (params) => {
                params.forEach((item) => {
                    Aux.show(item)
                })
            },
            "hideAll": (params) => {
                params.forEach((item) => {
                    Aux.hide(item)
                })
            }
        }

        let namesConstants = {
            "get": function (name) {
                try {
                    return namesConstants[name]
                } catch(e) {
                    Aux.error(e)
                }
            },
            "set": function (name, value) {
                try {
                    namesConstants[name] = value
                    return namesConstants[name]
                } catch(e) {
                    Aux.error(e)
                }
            }
        }

        let dataStorage = {
            "get": function (name) {
                try {
                    return dataStorage[name]
                } catch(e) {
                    Aux.error(e)
                }
            },
            "set": function (index, value) {
               try {
                    dataStorage[index] = value

                    return dataStorage[index]
                } catch(e) {
                    Aux.error(e)
                }
            }
        }

        let allModels = {
            "get": function (name) {
                try {
                    dataStorage[name] = allModels[name]['obj']

                    return dataStorage[name]
                } catch(e) {
                    console.error('error', e)
                }
            }
        }

        imageWidth = 6;

        function createModel(...args) {
            let model = new Interpolations(...args)

            model._id = args[0]
            allModels[model._id] = model

            return  allModels.get(args[0])
        }

        class Interpolations {
            constructor(name, obj) {
                this.obj = obj;
            }

            get() {
                return this.obj;
            }
        }

        dataObject = {
            "num": function (param) {
                let num_array = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10']

                if (param < num_array.length) {
                    return num_array[param]
                } else {
                    return param
                }
            },
            "num_day": function (param) {
                let num_array = ['00', '01', '02', '03', '04', '05', '06', '07', '08', '09']

                if (param < num_array.length) {
                    return num_array[param]
                } else {
                    return param
                }
            },
             "dataTransform": function (data) {
                let dataObject = []
                let x = data['x']
                let y = data['y']
                let comments = data['comments']
                let comment = ''

                for (item in x) {
                    let dateOut = x[item]
                    let value_y = y[item]

                    try {
                        comment = comments[item]

                    } catch(e) {
                        comment = ''
                    }

                    let date_format = this.str2date(dateOut)
                    let tooltip_date = this.dateFormat(dateOut)
                    dataObject.push({"comments": comment, "date": dateOut, "dates": dateOut, "dates_format": date_format, "tooltip_date": tooltip_date, "y": value_y})
                }

                return dataObject
            },
            "dateFormat": function(date) {
                let dateOut = new Date(date)

                return this.num_day(dateOut.getDate()) + '-' + this.num(dateOut.getMonth()) + '-' + dateOut.getFullYear() + ' ' + this.num(dateOut.getHours()) + ':' + this.num(dateOut.getMinutes())
            },
            "format": function(dateOut) {
                return this.num_day(dateOut.getDate()) + '-' + this.num(dateOut.getMonth()) + '-' + dateOut.getFullYear() + ' ' + this.num(dateOut.getHours()) + ':' + this.num(dateOut.getMinutes())
            },
            "str2date": function(date) {
                return new Date(date)
            }
        }

        function dump(data) {
            console.log('dump = ', data)
        }

        // Create models
        constants = createModel('constants', {{ constants | safe }})
        systolic = createModel('systolic', {{ systolic | safe }})
        pain_assessment = createModel('pain_assessment', {{ pain_assessment | safe }})
        diastolic = createModel('diastolic', {{ diastolic | safe }})
        pulse_ = createModel('pulse_', {{ pulse_ | safe }})
        weight_model = createModel('weight', {{ weight | safe }})
        medicine = createModel('medicine', {{ medicine | safe }})
        medicine_trace_data = createModel('medicine_trace_data', {{ medicine_trace_data | safe }})

        dump(systolic)
        dump(diastolic)
        dump(pulse_)

        namesConstants.set('color_pressure_up', 'orange')
        namesConstants.set('color_pressure_down', 'green')
        namesConstants.set('color_pulse', 'blue')
        namesConstants.set('color_danger', 'red')
        namesConstants.set('color_medicine', 'brown')
        namesConstants.set('color_glukose', '#a545c7')
        namesConstants.set('color_weight', 'lightgreen')
        namesConstants.set('color_temperature', '#23759F')

        // Create chart instance pressure
        am4core__.ready(function() {
            // Vars
            var i = 0
            var data = []
            var dynamic_data = []
            var dynamic_data_x = []
            var dynamic_data_y = []
            var diastolic_value = 0
            var pulse_value = 0
            var date = {}
            var tooltipText = ''
            var bullet_color = ''
            var systolic_up_color = ''
            var systolic_down_color = ''
            var diastolic_up_color = ''
            var diastolic_down_color = ''
            var pulse_up_color = ''
            var pulse_down_color = ''

            systolic['disabled_systolic'] = true

            var disabled_diastolic = true
            var disabled_pulse = true
            var disabled_glukose = true
            var systolic_dates = systolic['x']
            var systolic_values = systolic['y']
            var systolic_comments = systolic['comments']
            var diastolic_dates = diastolic['x']
            var diastolic_values = diastolic['y']
            var pulse_dates = pulse_['x']
            var pulse_values = pulse_['y']
            var medicine_x = medicine['x']
            var medicine_dates = ''
            var systolic_value = ''
            var pain_value = ''
            var comment = ''
            var medicine_y = 20
            var medicine_text = medicine['text']
            var medicine_amount = medicine['amount']
            var config = {}

            if (medicine_x.length > 0 && systolic_dates.length == 0) {
                systolic_dates = medicine_x
            }

            let dates_medicines = []
            let data_ = {}
            let date_in = ''
            let _y = 2
            let series_name = ''
            let dosage = ''
            let amount = ''
            let data_medicines_out = []
            let color_index = 0
            let medicine_colors = ["brown", "#536A56", "#91690D", "#DBD41A", "#B9ACAC", "#077317", "#072173", "#B35EBA", "#2F4892", "#840D91"]

            am4core__.useTheme(am4themes_animated)

            var chart = am4core__.create("chartdiv__", am4charts__.XYChart)
            chart.language.locale = am4lang_ru_RU

            // Create axes
            var categoryAxis = chart.xAxes.push(new am4charts__.DateAxis())

            {#categoryAxis.start = 0.79;#}
            {#categoryAxis.keepSelection = true;#}

            categoryAxis.renderer.grid.template.location = 0
            {#categoryAxis.renderer.labels.template.rotation = 90;#}
            {#categoryAxis.renderer.minGridDistance = 30;#}

            var valueAxis = chart.yAxes.push(new am4charts__.ValueAxis())
            {#valueAxis.max = 190#}
            let dateOut = ''
            let date_tooltip = ''

            let systolic_normal = 0

            valueAxis.renderer.minGridDistance = 100

            // Add data
            systolic_dates.forEach(function() {
                // 1

                systolic_value = systolic_values[i]
                diastolic_value = diastolic_values[i]
                pulse_value = pulse_values[i]
                comment = systolic_comments[i]

                // 2

                if (systolic_value >= constants.max_systolic || systolic_value < constants.min_systolic) {
                    systolic_up_color = namesConstants.get('color_danger')
                    systolic['disabled_systolic'] = false
                } else {
                    systolic_up_color = namesConstants.get('color_pressure_up')
                    systolic['disabled_systolic'] = true
                }

                if (diastolic_value >= constants.max_diastolic || diastolic_value < constants.min_diastolic) {
                    diastolic_down_color = namesConstants.get('color_danger')
                    disabled_diastolic = false
                } else {
                    diastolic_down_color = namesConstants.get('color_pressure_down')
                    disabled_diastolic = true
                }

                if (pulse_value >= constants.max_pulse || pulse_value < constants.min_pulse) {
                    pulse_up_color = namesConstants.get('color_danger')
                    disabled_pulse = false
                } else {
                    pulse_up_color = namesConstants.get('color_pulse')
                    disabled_pulse = true
                }

                dateOut = new Date(systolic_dates[i])
                date_tooltip = dataObject.format(dateOut)

                if (i == 0) {
                    dynamic_data_x.push(dateOut)
                    dynamic_data_y.push(systolic_dates.length)
                }

                if (i > 0 && systolic_value < constants.max_systolic) {
                    systolic_normal++
                    dynamic_data_x.push(dateOut)
                    dynamic_data_y.push(i/systolic_normal)
                }

                data[i] = {
                    systolic_pressure: systolic_value,
                    diastolic_pressure: diastolic_value,
                    comment: comment,
                    pulse_value: pulse_value,
                    date: dateOut,
                    date_tooltip: date_tooltip,
                    max_systolic: constants.max_systolic,
                    min_diastolic: constants.min_diastolic,
                    max_pulse: constants.max_pulse,
                    systolic_up_color: systolic_up_color,
                    diastolic_down_color: diastolic_down_color,
                    pulse_up_color: pulse_up_color,
                    disabled_systolic: systolic['disabled_systolic'],
                    disabled_diastolic: disabled_diastolic,
                    disabled_pulse: disabled_pulse
                }
                i++
            })

            data[data.length+1] = {
                date: new Date()
            }

            dynamic_data['x'] = dynamic_data_x
            dynamic_data['y'] = dynamic_data_y
            dynamic_data['name'] = 'Динамика роста давления'
            chart.data = data.reverse();

            let date_max = new Date(systolic['date_max'])
            let date_min = new Date(systolic['date_min'])
            let zoomToDates = systolic['zoomToDates']

            // Pre-zoom the chart

            dump(date_min)
            dump(date_max)
            dump(zoomToDates)

            if (zoomToDates == 'on') {
                chart.events.on("ready", function () {
                    categoryAxis.zoomToDates(
                        date_min,
                        date_max
                    );
                });
            }

            {#chart.events.on("ready", function () {#}
            {#    categoryAxis.zoomToDates(#}
            {#        date_min,#}
            {#        date_max#}
            {#    );#}
            {#});#}

            // Create series Medicine
            function createSeriesMedicine(field, data, series_name, color, config) {
                var series = chart.series.push(new am4charts__.LineSeries());
                series.dataFields.valueY = field
                series.dataFields.dateX = "date_out"
                series.dataFields.value = "name"
                series.name = series_name
                {#series.tooltipText = "medicine_text";#}
                {#series.strokeWidth = 2;#}
                {#series.propertyFields.stroke = "color"#}
                {#series.stroke = am4core__.color("yellow")#}
                series.strokeOpacity = 0
                {#series.sequencedInterpolation = true#}
                series.data = data

                {#var bullet = series.bullets.push(new am4core__.Circle())#}

                var bullet = series.bullets.push(new am4charts__.Bullet())
                var square = bullet.createChild(am4core.Rectangle)
                square.width = 12
                square.height = 12
                square.horizontalCenter = "middle"
                square.verticalCenter = "middle"

                bullet.fill = am4core__.color(color)
                bullet.strokeOpacity = 0
                bullet.radius = 5
                bullet.fillOpacity = 0.7
                {#bullet.strokeWidth = 2#}
                {#bullet.stroke = am4core__.color("#ffffff")#}

                bullet.tooltipText = "{name} | {dosage} {amount} | время приема: {date_tooltip}"

                var hoverState = bullet.states.create("hover")
                hoverState.properties.fillOpacity = 1
                hoverState.properties.strokeOpacity = 1

                series.heatRules.push({ target: bullet, min: 2, max: 17, property: "radius" })
                chart.scrollbarX = new am4core__.Scrollbar()
            }

            for (key in medicine_trace_data) {
                data_ = medicine_trace_data[key]
                dosage = data_.dosage
                amount = data_.amount
                dates_medicines = data_.medicines_times_
                series_name = key
                data_medicines_out = []

                for (item in dates_medicines) {
                    date_in = new Date(dates_medicines[item])
                    date_tooltip = dataObject.format(date_in)
                    data_medicines_out.push({"date_tooltip": date_tooltip, "date_out": date_in, "Y": _y, "series_name": series_name, "name": series_name, "dosage": dosage, "amount": amount})

                }

                if (data_medicines_out.length > 0) {
                    createSeriesMedicine('Y', data_medicines_out, series_name, medicine_colors[color_index])
                }

                _y += 3
                color_index++
            }

            // Creation series function for Pressure
            function createSeries(field, name, config, data) {
                var series = chart.series.push(new am4charts__.LineSeries());
                series.groupData = false;

                series.dataFields.valueY = field;
                series.dataFields.dateX = "date";
                series.name = name;
                series.tooltipText = config.tooltipText;
                series.strokeWidth = 2;
                series.propertyFields.stroke = "color";
                series.stroke = am4core__.color(config.color);

                {#series.data = data#}
                {#yAxis.min = 190#}

                {#bullet = series.bullets.push(new am4charts__.CircleBullet())#}
                {#bullet.circle.strokeWidth = 1#}

                var bullet = series.bullets.push(new am4charts.Bullet());
                let image = bullet.createChild(am4core.Image);
                {#image.href = "https://www.amcharts.com/lib/images/star.svg";#}
                image.href = "https://img2.freepng.ru/20180328/faw/kisspng-circle-symbol-font-new-5abb8f0aa93728.5304686315222412906931.jpg";
                image.width = imageWidth;
                image.height = imageWidth;
                image.horizontalCenter = "middle";
                image.verticalCenter = "middle";

                bullet.tooltipText = config.tooltipText;
                chart.scrollbarX = new am4core__.Scrollbar();
                {#chart.scrollbarН = new am4core__.Scrollbar()#}

                if (name == systolic.name) {
                    {#image.href = "https://img2.freepng.ru/20180328/faw/kisspng-circle-symbol-font-new-5abb8f0aa93728.5304686315222412906931.jpg";#}

                    {#bullet.propertyFields.fill = "systolic_up_color"#}
                    bullet.disabled = true;
                    bullet.propertyFields.disabled = "disabled_systolic";
                }

                if (name == diastolic.name) {
                    {#image.href = "https://img2.freepng.ru/20180328/faw/kisspng-circle-symbol-font-new-5abb8f0aa93728.5304686315222412906931.jpg";#}

                    {#bullet.propertyFields.fill = "diastolic_down_color"#}
                    bullet.disabled = true;
                    bullet.propertyFields.disabled = "disabled_diastolic";
                }

                if (name == pulse_.name) {
                    {#image.href = "https://img2.freepng.ru/20180328/faw/kisspng-circle-symbol-font-new-5abb8f0aa93728.5304686315222412906931.jpg";#}

                    {#bullet.propertyFields.fill = "pulse_up_color"#}
                    bullet.disabled = true;
                    bullet.propertyFields.disabled = "disabled_pulse";
                }
            }

            tooltipText = "Верхнее давление: [bold]{systolic_pressure}[normal] " + " | до " + constants.max_systolic + " | {date_tooltip}" + "\n {comment}"

            config = {
                "color": namesConstants.get('color_pressure_up'),
                "tooltipText": tooltipText
            }

            createSeries("systolic_pressure", systolic.name, config)

            tooltipText = "Нижнее давление: [bold]{diastolic_pressure}[normal]" + " | до " + constants.max_diastolic + " | {date_tooltip}"

            config = {
                "color": namesConstants.get('color_pressure_down'),
                "tooltipText": tooltipText
            }

            createSeries("diastolic_pressure", diastolic.name, config)

            tooltipText = "Пульс: [bold]{pulse_value}[normal] | от " + constants.min_pulse + " до " + constants.max_pulse + " | " + " {date_tooltip}"

            config = {
                "color": namesConstants.get('color_pulse'),
                "tooltipText": tooltipText
            }

            createSeries("pulse_value", pulse_.name, config);

            chart.legend = new am4charts__.Legend();
            chart.cursor = new am4charts__.XYCursor();

            // Enable export
            chart.exporting.menu = new am4core__.ExportMenu()

            })

        //  ************************************* END am4core.ready()

    </script>

    <!-- Chart pain -->
    <script>
        am4core_pain = am4core
        am4charts_pain = am4charts

        am4core_pain.ready(function() {
            delta_y = 11
            dates_medicines = []
            data_ = {}
            date_in = ''
            series_name = ''
            dosage = ''
            amount = ''
            data_medicines_out = []
            color_index = 0
            medicine_colors = ["brown", "#536A56", "#91690D", "#DBD41A", "#B9ACAC", "#077317", "#072173", "#B35EBA", "#2F4892", "#840D91"]

            // ******* START pain_dates.forEach

            iterator_pain_dates = 0
            data_pain = []
            pain_dates = pain_assessment['x']
            pain_values = pain_assessment['y']
            pain_comments = pain_assessment['comments']
            pain_value = ''
            disabled_pain = false

            pain_dates.forEach(function() {
                pain_value = pain_values[iterator_pain_dates]

                if (pain_value == 0) {
                    pain_value = pain_value + " баллов"
                }

                if (pain_value == 1) {
                    pain_value = pain_value + " балл"
                }

                if (pain_value > 1 && pain_value < 5) {
                    pain_value = pain_value + " балла"
                }

                if (pain_value > 4) {
                    pain_value = pain_value + " баллов"
                }

                pain_comment = pain_comments[iterator_pain_dates]

                pain_dateOut = new Date(pain_dates[iterator_pain_dates])
                pain_date_tooltip = dataObject.format(pain_dateOut)

                if (pain_value >= constants.max_pain || pain_value < constants.min_pain) {
                    pain_up_color = "red"
                    disabled_pain = false
                } else {
                    pain_up_color = "brown"
                    disabled_pain = true
                }

                if (pain_value == 10) {
                    disabled_pain = true
                }

                data_pain[iterator_pain_dates] = {
                    pain_value: pain_value,
                    pain_comment: pain_comment,
                    pain_date: pain_dateOut,
                    pain_date_tooltip: pain_date_tooltip,
                    max_pain: constants.max_pain,
                    min_pain: constants.min_pain,
                    {#pain_up_color: "red",#}
                    {#pain_down_color: "brown",#}
                    disabled_pain: disabled_pain,
                }

                iterator_pain_dates++
            })

            // *********************************************
            // ******* Create chart instance pain_assessment
            // *********************************************

            am4core_pain.useTheme(am4themes_animated)

            let chart_pain = am4core_pain.create("chartdiv_pain", am4charts_pain.XYChart)
            chart_pain.language.locale = am4lang_ru_RU

            // Create axes
            let categoryAxis_pain = chart_pain.xAxes.push(new am4charts_pain.DateAxis())
            categoryAxis_pain.renderer.grid.template.location = 0

            {#categoryAxis_pain.start = 0.8;#}
            {#categoryAxis_pain.keepSelection = true;#}

            {#categoryAxis.renderer.labels.template.rotation = 90;#}
            {#categoryAxis.renderer.minGridDistance = 30;#}

            let valueAxis_pain = chart_pain.yAxes.push(new am4charts_pain.ValueAxis())
            {#valueAxis.max = 190#}
            {#let dateOut = ''#}
            {#let date_tooltip = ''#}
            {##}
            {#let pain_date_tooltip = ''#}
            {#let systolic_normal = 0#}

            valueAxis_pain.renderer.minGridDistance = 50

            chart_pain.data = data_pain.reverse()

            let date_max = new Date(pain_assessment['date_max']);
            let date_min = new Date(pain_assessment['date_min']);

            // Pre-zoom the chart
            chart_pain.events.on("ready", function () {
                categoryAxis_pain.zoomToDates(
                    date_min,
                    date_max
                );
            });

            image_width_pain = 9

            // Create series for pain_assessment
            function createSeriesPain(field, name, config) {
                var series_pain = chart_pain.series.push(new am4charts_pain.LineSeries());
                // 1-й параметр - значение по оси x
                series_pain.dataFields.valueY = field;
                // 2-й параметр - значение по оси y
                series_pain.dataFields.dateX = "pain_date";
                series_pain.name = name;
                series_pain.tooltipText = config.tooltipText;
                series_pain.strokeWidth = 2;
                series_pain.propertyFields.stroke = "color"
                series_pain.stroke = am4core_pain.color(config.color)
                {#series_pain.data = data_pain#}
                {#yAxis.min = 190#}

                {#bullet = series.bullets.push(new am4charts__.CircleBullet())#}
                {#bullet.circle.strokeWidth = 1#}

                var bullet_pain = series_pain.bullets.push(new am4charts_pain.Bullet());
                var image_pain = bullet_pain.createChild(am4core_pain.Image);
                {#image.href = "https://www.amcharts.com/lib/images/star.svg";#}
                image_pain.href = "https://img2.freepng.ru/20180328/faw/kisspng-circle-symbol-font-new-5abb8f0aa93728.5304686315222412906931.jpg";
                image_pain.width = image_width_pain;
                image_pain.height = image_width_pain;
                image_pain.horizontalCenter = "middle";
                image_pain.verticalCenter = "middle";

                bullet_pain.disabled = true
                bullet_pain.propertyFields.disabled = "disabled_pain"

                bullet_pain.tooltipText = config.tooltipText
                chart_pain.scrollbarX = new am4core_pain.Scrollbar()
            }

            tooltipText = "{pain_date_tooltip} | {pain_value} | {pain_comment}"

            config = {
                "color": "green",
                "tooltipText": tooltipText
            }

            // 1-й параметр - значение по оси x
            createSeriesPain("pain_value", 'Оценка боли', config)

            // ***************************************
            // ******* Create chart instance medicines
            // ***************************************

            // Create series for medicine
            function createSeriesMedicine(field, data, series_name, color, config) {
                let series_medicine = chart_pain.series.push(new am4charts_pain.LineSeries());
                series_medicine.dataFields.valueY = field
                series_medicine.dataFields.dateX = "date_out"
                series_medicine.dataFields.value = "name"
                series_medicine.name = series_name
                {#series.tooltipText = "medicine_text";#}
                {#series.strokeWidth = 2;#}
                {#series.propertyFields.stroke = "color"#}
                {#series.stroke = am4core__.color("yellow")#}
                series_medicine.strokeOpacity = 0
                {#series.sequencedInterpolation = true#}
                series_medicine.data = data

                {#var bullet = series.bullets.push(new am4core__.Circle())#}

                let bullet_medicine = series_medicine.bullets.push(new am4charts_pain.Bullet())
                let square = bullet_medicine.createChild(am4core.Rectangle)
                square.width = 12
                square.height = 12
                square.horizontalCenter = "middle"
                square.verticalCenter = "middle"

                bullet_medicine.fill = am4core_pain.color(color)
                bullet_medicine.strokeOpacity = 0
                bullet_medicine.radius = 5
                bullet_medicine.fillOpacity = 0.7
                {#bullet.strokeWidth = 2#}
                {#bullet.stroke = am4core__.color("#ffffff")#}

                bullet_medicine.tooltipText = "{name} | {dosage} {amount} | время приема: {date_tooltip}"

                let hoverState = bullet_medicine.states.create("hover")
                hoverState.properties.fillOpacity = 1
                hoverState.properties.strokeOpacity = 1

                series_medicine.heatRules.push({ target: bullet_medicine, min: 2, max: 17, property: "radius" })
                chart_pain.scrollbarX = new am4core_pain.Scrollbar()
            }

            for (key in medicine_trace_data) {
                data_ = medicine_trace_data[key]
                dosage = data_.dosage
                amount = data_.amount
                dates_medicines = data_.medicines_times_
                series_name = key
                data_medicines_out = []

                for (item in dates_medicines) {
                    date_in = new Date(dates_medicines[item])
                    date_tooltip = dataObject.format(date_in)
                    data_medicines_out.push({"date_tooltip": date_tooltip, "date_out": date_in, "Y": delta_y, "series_name": series_name, "name": series_name, "dosage": dosage, "amount": amount})

                }

                if (data_medicines_out.length > 0) {
                    createSeriesMedicine('Y', data_medicines_out, series_name, medicine_colors[color_index])
                }

                delta_y += 3
                color_index++
            }

            // *********************************************

            chart_pain.legend = new am4charts_pain.Legend();
            chart_pain.cursor = new am4charts_pain.XYCursor();

            // Enable export
            chart_pain.exporting.menu = new am4core_pain.ExportMenu()

            // End *******

        })
    </script>

    <script>
        let model = {}
        let am4Objects = {
            "get": function (name) {
                try {
                    return am4Objects[name]
                } catch(e) {
                    Aux.error(e)
                }
            },
            "set": function (name, value) {
                try {
                    am4Objects[name] = value
                    return am4Objects[name]
                } catch(e) {
                    Aux.error(e)
                }
            }
        }
        let am4Core = {
            "get": function (name) {
                try {
                    return namesConstants[name]
                } catch(e) {
                    Aux.error(e)
                }
            },
            "set": function (name, value) {
                try {
                    namesConstants[name] = value
                    return namesConstants[name]
                } catch(e) {
                    Aux.error(e)
                }
            },
            "darkTheme": function (obj) {
                try {
                    obj.useTheme(am4themes_dark)
                    obj.useTheme(am4themes_animated)
                } catch(e) {
                    Aux.error(e)
                }
            },
            "defaultTheme": function (obj) {
                try {
                    obj.useTheme(am4themes_animated)
                } catch(e) {
                    Aux.error(e)
                }
            },
            "makeGraph": function(params) {
                chart = am4core.create(params.div, am4charts.XYChart)
                chart.language.locale = params.lang
                dateAxis = chart.xAxes.push(new am4charts.DateAxis())
                dateAxis.renderer.grid.template.location = params.location

                {#dateAxis.start = 0.8;#}
                {#dateAxis.keepSelection = true;#}

                let date_max = new Date(params.model['date_max']);
                let date_min = new Date(params.model['date_min']);

                // Pre-zoom the chart
                chart.events.on("ready", function () {
                    dateAxis.zoomToDates(
                        date_min,
                        date_max
                    );
                });

                yAxis = chart.yAxes.push(new am4charts.ValueAxis())
                yAxis.min = params.y_min
                yAxis.max = params.y_max
                model = params.model
                data = dataObject.dataTransform(model)
                data = data.reverse()
                min = params.min
                max = params.max

                for (key in data) {
                    if (data[key]['y'] > max || data[key]['y'] < min) {
                        data[key]['color_danger'] = namesConstants.get('color_danger')
                        data[key]['disabled'] = false
                    } else {
                        data[key]['disabled'] = true
                    }
                }

                tooltipText = model.name + ": [bold]{y}[normal] | от " + min + " до " + max + " | {tooltip_date}" + "\n {comments}"

                config = {
                    "name": model.name,
                    "field": "y",
                    "dateX": "dates_format",
                    "comments": "comments",
                    "tooltipText": tooltipText,
                    "color": params.color,
                    "color_danger": "color_danger",
                    "strokeWidth": params.strokeWidth,
                    "disabled": "disabled",
                    "chart": chart
                }

                {#console.warn('config', config)#}

                am4Core.createSeries(data, config)

                // Create legend
                chart.legend = new am4charts.Legend()

                // Create cursor
                chart.cursor = new am4charts.XYCursor()

                // Enable export
                chart.exporting.menu = new am4core.ExportMenu()
            },
            "createSeries": function(data, config) {
                let series = config.chart.series.push(new am4charts.LineSeries())
                config.chart.scrollbarX = new am4core.Scrollbar()
                series.dataFields.valueY = config.field
                series.dataFields.dateX = config.dateX
                series.dataFields.comments = config.comments
                series.name = config.name

                dump(config)

                series.tooltipText = config.tooltipText
                series.strokeWidth = config.strokeWidth
                series.stroke = config.color
                series.data = data
                {#series.tensionX = 0.8#}

                let bullet = series.bullets.push(new am4charts.Bullet())
                {#let bullet = series.bullets.push(new am4charts.CircleBullet())#}
                {#bullet.circle.stroke = am4core_glukose.color(config.color)#}
                {#bullet.circle.strokeWidth = config.strokeWidth#}

                bullet.circle.fill = am4charts.color("#fff");
                bullet.circle.strokeWidth = 2;

                {#bullet.propertyFields.fill = config.color_danger#}
                bullet.disabled = "disabled"
                bullet.propertyFields.disabled = config.disabled

                let image = bullet.createChild(am4core.Image);
                {#image.href = "https://www.amcharts.com/lib/images/star.svg";#}
                image.href = "https://img2.freepng.ru/20180328/faw/kisspng-circle-symbol-font-new-5abb8f0aa93728.5304686315222412906931.jpg";
                image.width = imageWidth;
                image.height = imageWidth;
                image.horizontalCenter = "middle";
                image.verticalCenter = "middle";

                return series;
            }
        }

        {#am4Core.darkTheme(am4core)#}
        am4Core.defaultTheme(am4core)
        let strokeWidth = 2
        let date_max;
        let date_min;

        // ************************************
        // ******* Create chart instance shin
        // ************************************

        shin_left = {{ shin_left | safe }};
        shin_right = {{ shin_right | safe }};

        var chart = am4core.create("chartdiv_shin", am4charts.XYChart);
        chart.scrollbarX = new am4core.Scrollbar()
        chart.language.locale = am4lang_ru_RU;

        shinData = [];

        i = 0
        shin_left.x.forEach(function(date) {
            shinData.push({'date': new Date(date), 'value1': shin_left.y[i], 'value2': shin_right.y[i], 'previousDate': new Date(shin_right.x[i])});

            i++
        })

        // Add data
        chart.data = shinData.reverse()

        // Create axes
        var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
        dateAxis.renderer.minGridDistance = 50;

        {#dateAxis.start = 0.8;#}
        {#dateAxis.keepSelection = true;#}

        date_max = new Date(shin_left['date_max']);
        date_min = new Date(shin_left['date_min']);

        // Pre-zoom the chart
        chart.events.on("ready", function () {
            dateAxis.zoomToDates(
                date_min,
                date_max
            );
        });

        var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

        // Create series
        var series = chart.series.push(new am4charts.LineSeries());
        series.dataFields.valueY = "value1";
        series.dataFields.dateX = "date";
        series.strokeWidth = 2;
        series.minBulletDistance = 10;
        series.tooltipText = "Объем левой голени: [bold]{value1}[/] см | {date.formatDate('dd-MM-yyyy k:mm')}\nОбъем правой голени: [bold]{value2}[/] см | {previousDate.formatDate('dd-MM-yyyy k:mm')}";
        series.tooltip.pointerOrientation = "vertical";
        series.name = 'Обхват голени'

        // Create series
        var series2 = chart.series.push(new am4charts.LineSeries());
        series2.dataFields.valueY = "value2";
        series2.dataFields.dateX = "date";
        series2.strokeWidth = 2;
        series2.strokeDasharray = "3,4";
        series2.stroke = series.stroke;

        // Create legend
        chart.legend = new am4charts.Legend()

        // Add cursor
        chart.cursor = new am4charts.XYCursor();
        chart.cursor.xAxis = dateAxis;

        // Enable export
        chart.exporting.menu = new am4core.ExportMenu()

        // ************************************
        // ******* Create chart instance waist
        // ************************************

        model = {{ waist | safe }}
        model['min'] = constants.min_waist
        model['max'] = constants.max_waist

        model['name'] = 'Окружность талии'

        params = {
            "div": "chartdiv_waist",
            "lang": am4lang_ru_RU,
            "location": 0,
            "distance": 100,
            "y_min": 0,
            "y_max": 100,
            "min": model.min,
            "max": model.max,
            "color": "#2f2f1e",
            "strokeWidth": strokeWidth,
            "comments": model.comments,
            "model": model
        }

        {#am4Core.makeGraph(params)#}


                chart_waist = am4core.create(params.div, am4charts.XYChart)
                chart_waist.language.locale = params.lang
                dateAxis_waist = chart_waist.xAxes.push(new am4charts.DateAxis())
                dateAxis_waist.renderer.grid.template.location = params.location

                {#dateAxis.start = 0.8;#}
                {#dateAxis.keepSelection = true;#}

                date_max = new Date(params.model['date_max']);
                date_min = new Date(params.model['date_min']);

                // Pre-zoom the chart
                chart_waist.events.on("ready", function () {
                    dateAxis_waist.zoomToDates(
                        date_min,
                        date_max
                    );
                });

                yAxis_waist = chart_waist.yAxes.push(new am4charts.ValueAxis())
                yAxis_waist.min = params.y_min
                yAxis_waist.max = params.y_max
                model = params.model
                data = dataObject.dataTransform(model)
                data = data.reverse()
                min = params.min
                max = params.max

                for (key in data) {
                    if (data[key]['y'] > max || data[key]['y'] < min) {
                        data[key]['color_danger'] = namesConstants.get('color_danger')
                        data[key]['disabled'] = false
                    } else {
                        data[key]['disabled'] = true
                    }
                }

                tooltipText = model.name + ": [bold]{y}[normal] | от " + min + " до " + max + " | {tooltip_date}" + "\n {comments}"

                config = {
                    "name": model.name,
                    "field": "y",
                    "dateX": "dates_format",
                    "comments": "comments",
                    "tooltipText": tooltipText,
                    "color": params.color,
                    "color_danger": "color_danger",
                    "strokeWidth": params.strokeWidth,
                    "disabled": "disabled",
                    "chart": chart_waist
                }

                {#console.warn('config', config)#}

                am4Core.createSeries(data, config)

                // Create legend
                chart_waist.legend = new am4charts.Legend()

                // Create cursor
                chart_waist.cursor = new am4charts.XYCursor()

                // Enable export
                chart_waist.exporting.menu = new am4core.ExportMenu()


        // ************************************
        // ******* Create chart instance spo2
        // ************************************

        model = {{ spo2 | safe }}
        model['min'] = constants.min_spo2
        model['max'] = constants.max_spo2

        model['name'] = 'Насыщение крови кислородом'

        params = {
            "div": "chartdiv_spo2",
            "lang": am4lang_ru_RU,
            "location": 0,
            "distance": 100,
            "y_min": 0,
            "y_max": 100,
            "min": model.min,
            "max": model.max,
            "color": "brown",
            "strokeWidth": strokeWidth,
            "comments": model.comments,
            "model": model
        }

        //am4Core.makeGraph(params)



                chart_spo2 = am4core.create(params.div, am4charts.XYChart)
                chart_spo2.language.locale = params.lang
                dateAxis_spo2 = chart_spo2.xAxes.push(new am4charts.DateAxis())
                dateAxis_spo2.renderer.grid.template.location = params.location

                {#dateAxis.start = 0.8;#}
                {#dateAxis.keepSelection = true;#}

                date_max = new Date(params.model['date_max']);
                date_min = new Date(params.model['date_min']);

                // Pre-zoom the chart
                chart_spo2.events.on("ready", function () {
                    dateAxis_spo2.zoomToDates(
                        date_min,
                        date_max
                    );
                });

                yAxis_spo2 = chart_spo2.yAxes.push(new am4charts.ValueAxis())
                yAxis_spo2.min = params.y_min
                yAxis_spo2.max = params.y_max
                model = params.model
                data = dataObject.dataTransform(model)
                data = data.reverse()
                min = params.min
                max = params.max

                for (key in data) {
                    if (data[key]['y'] > max || data[key]['y'] < min) {
                        data[key]['color_danger'] = namesConstants.get('color_danger')
                        data[key]['disabled'] = false
                    } else {
                        data[key]['disabled'] = true
                    }
                }

                tooltipText = model.name + ": [bold]{y}[normal] | от " + min + " до " + max + " | {tooltip_date}" + "\n {comments}"

                config = {
                    "name": model.name,
                    "field": "y",
                    "dateX": "dates_format",
                    "comments": "comments",
                    "tooltipText": tooltipText,
                    "color": params.color,
                    "color_danger": "color_danger",
                    "strokeWidth": params.strokeWidth,
                    "disabled": "disabled",
                    "chart": chart_spo2
                }

                {#console.warn('config', config)#}

                am4Core.createSeries(data, config)

                // Create legend
                chart_spo2.legend = new am4charts.Legend()

                // Create cursor
                chart_spo2.cursor = new am4charts.XYCursor()

                // Enable export
                chart_spo2.exporting.menu = new am4core.ExportMenu()

        // *****************************************
        // ******* Create chart instance temperature
        // *****************************************

        model = {{ temperature | safe }}
        model['min'] = constants.min_temperature
        model['max'] = constants.max_temperature
        {#model['tooltipText'] = model.name + ": [bold]{y}[normal] | от " + model.min + " до " + model.max + " | {tooltip_date}"#}

        params = {
            "div": "chartdiv_temperature",
            "lang": am4lang_ru_RU,
            "location": 0,
            "distance": 100,
            "y_min": 33,
            "y_max": 43,
            "min": model.min,
            "max": model.max,
            "color": "#23759F",
            "strokeWidth": strokeWidth,
            "model": model
        }

        {#am4Core.makeGraph(params)#}

                chart_temperature = am4core.create(params.div, am4charts.XYChart)
                chart_temperature.language.locale = params.lang
                dateAxis_temperature = chart_temperature.xAxes.push(new am4charts.DateAxis())
                dateAxis_temperature.renderer.grid.template.location = params.location

                {#dateAxis.start = 0.8;#}
                {#dateAxis.keepSelection = true;#}

                date_max = new Date(params.model['date_max']);
                date_min = new Date(params.model['date_min']);

                // Pre-zoom the chart
                chart_temperature.events.on("ready", function () {
                    dateAxis_temperature.zoomToDates(
                        date_min,
                        date_max
                    );
                });

                yAxis_temperature = chart_temperature.yAxes.push(new am4charts.ValueAxis())
                yAxis_temperature.min = params.y_min
                yAxis_temperature.max = params.y_max
                model = params.model
                data = dataObject.dataTransform(model)
                data = data.reverse()
                min = params.min
                max = params.max

                for (key in data) {
                    if (data[key]['y'] > max || data[key]['y'] < min) {
                        data[key]['color_danger'] = namesConstants.get('color_danger')
                        data[key]['disabled'] = false
                    } else {
                        data[key]['disabled'] = true
                    }
                }

                tooltipText = model.name + ": [bold]{y}[normal] | от " + min + " до " + max + " | {tooltip_date}" + "\n {comments}"

                config = {
                    "name": model.name,
                    "field": "y",
                    "dateX": "dates_format",
                    "comments": "comments",
                    "tooltipText": tooltipText,
                    "color": params.color,
                    "color_danger": "color_danger",
                    "strokeWidth": params.strokeWidth,
                    "disabled": "disabled",
                    "chart": chart_temperature
                }

                am4Core.createSeries(data, config)

                // Create legend
                chart_temperature.legend = new am4charts.Legend()

                // Create cursor
                chart_temperature.cursor = new am4charts.XYCursor()

                // Enable export
                chart_temperature.exporting.menu = new am4core.ExportMenu()

        // *************************************
        // ******* Create chart instance glukose
        // *************************************

        model = {{ glukose | safe }}
        model['min'] = constants.min_glukose
        model['max'] = constants.max_glukose
        {#model['tooltipText'] = model.name + ": [bold]{y}[normal] | от " + model.min + " до " + model.max + " | {tooltip_date}"#}

        params = {
            "div": "chartdiv_glukose",
            "lang": am4lang_ru_RU,
            "location": 0,
            "distance": 100,
            "y_min": 0,
            "y_max": 20,
            "min": model.min,
            "max": model.max,
            "color": "#a545c7",
            "strokeWidth": strokeWidth,
            "model": model
        }

        {#am4Core.makeGraph(params)#}

        chart_glukose = am4core.create(params.div, am4charts.XYChart)
        chart_glukose.language.locale = params.lang
        dateAxis_glukose = chart_glukose.xAxes.push(new am4charts.DateAxis())
        dateAxis_glukose.renderer.grid.template.location = params.location

        {#dateAxis.start = 0.8;#}
        {#dateAxis.keepSelection = true;#}

        date_max = new Date(params.model['date_max']);
        date_min = new Date(params.model['date_min']);

        // Pre-zoom the chart
        chart_glukose.events.on("ready", function () {
            dateAxis_glukose.zoomToDates(
                date_min,
                date_max
            );
        });

        yAxis_glukose = chart_glukose.yAxes.push(new am4charts.ValueAxis())
        yAxis_glukose.min = params.y_min
        yAxis_glukose.max = params.y_max
        model = params.model
        data = dataObject.dataTransform(model)
        data = data.reverse()
        min = params.min
        max = params.max

        for (key in data) {
            if (data[key]['y'] > max || data[key]['y'] < min) {
                data[key]['color_danger'] = namesConstants.get('color_danger')
                data[key]['disabled'] = false
            } else {
                data[key]['disabled'] = true
            }
        }

        tooltipText = model.name + ": [bold]{y}[normal] | от " + min + " до " + max + " | {tooltip_date}" + "\n {comments}"

        config = {
            "name": model.name,
            "field": "y",
            "dateX": "dates_format",
            "comments": "comments",
            "tooltipText": tooltipText,
            "color": params.color,
            "color_danger": "color_danger",
            "strokeWidth": params.strokeWidth,
            "disabled": "disabled",
            "chart": chart_glukose
        }

        {#console.warn('config', config)#}

        am4Core.createSeries(data, config)

        // Create legend
        chart_glukose.legend = new am4charts.Legend()

        // Create cursor
        chart_glukose.cursor = new am4charts.XYCursor()

        // Enable export
        chart_glukose.exporting.menu = new am4core.ExportMenu()


        // ************************************
        // ******* Create chart instance weight
        // ************************************

        model = {{ weight | safe }}
        model['min'] = constants.min_weight
        model['max'] = constants.max_weight
        {#model['tooltipText'] = model.name + ": [bold]{y}[normal] | от " + model.min + " до " + model.max + " | {tooltip_date}" + "\n" + "{comments}"#}

        params = {
            "div": "chartdiv_weight",
            "lang": am4lang_ru_RU,
            "location": 0,
            "distance": 100,
            "y_min": 0,
            "y_max": 150,
            "min": model.min,
            "max": model.max,
            "color": "lightgreen",
            "strokeWidth": strokeWidth,
            "comments": model.comments,
            "model": model
        }

                chart_weight = am4core.create(params.div, am4charts.XYChart);
                chart_weight.language.locale = params.lang;
                dateAxis_weight = chart_weight.xAxes.push(new am4charts.DateAxis());
                dateAxis_weight.renderer.grid.template.location = params.location;

                {#dateAxis.start = 0.8;#}
                {#dateAxis.keepSelection = true;#}

                date_max = new Date(params.model['date_max']);
                date_min = new Date(params.model['date_min']);

                // Pre-zoom the chart
                chart_weight.events.on("ready", function () {
                    dateAxis_weight.zoomToDates(
                        date_min,
                        date_max
                    );
                });

                yAxis_weight = chart_weight.yAxes.push(new am4charts.ValueAxis());
                yAxis_weight.min = params.y_min;
                yAxis_weight.max = params.y_max;
                model = params.model;
                data = dataObject.dataTransform(model);
                data = data.reverse();
                min = params.min;
                max = params.max;

                for (key in data) {
                    if (data[key]['y'] > max || data[key]['y'] < min) {
                        data[key]['color_danger'] = namesConstants.get('color_danger');
                        data[key]['disabled'] = false;
                    } else {
                        data[key]['disabled'] = true;
                    }
                }

                tooltipText = model.name + ": [bold]{y}[normal] | от " + min + " до " + max + " | {tooltip_date}" + "\n {comments}";

                dump(params.strokeWidth)

                config = {
                    "name": model.name,
                    "field": "y",
                    "dateX": "dates_format",
                    "comments": "comments",
                    "tooltipText": tooltipText,
                    "color": params.color,
                    "color_danger": "color_danger",
                    "strokeWidth": params.strokeWidth,
                    "disabled": "disabled",
                    "chart": chart_weight
                }

                {#console.warn('config', config)#}

                am4Core.createSeries(data, config);

                // Create legend
                chart_weight.legend = new am4charts.Legend();

                // Create cursor
                chart_weight.cursor = new am4charts.XYCursor();

                // Enable export
                chart_weight.exporting.menu = new am4core.ExportMenu();
    </script>

    <!-- Chart pressure -->
    <script>
        let main = {};
        let i = 0;
        let j = 0;
        let sum = 0;
        let data_sys = [];
        let data_dia = [];
        let data_pulse = [];
        let averaged = [];
        let constants = {{ constants | safe }};
        let systolic = {{ systolic | safe }};
        let diastolic = {{ diastolic | safe }};
        let pulse = {{ pulse_ | safe }};
        let timestamp_for_pressure = systolic.timestamp_for_pressure;
        let arr = []

        let formatDate = function (timestamp_) {
            let date_ = new Date(timestamp_);
            let sep = '-';
            let sep_time = ':';
            let spacebar = ' ';

            return num_day(date_.getDate()) + sep + num(date_.getMonth()) + sep + date_.getFullYear() + spacebar + num(date_.getHours()) + sep_time + num(date_.getMinutes()) + sep_time + num(date_.getSeconds());
        };

        let num = function (param) {
            let num_array = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10']

            if (param < num_array.length) {
                return num_array[param]
            } else {
                return param
            }
        };

        let num_day = function (param) {
            let num_array = ['00', '01', '02', '03', '04', '05', '06', '07', '08', '09']

            if (param < num_array.length) {
                return num_array[param]
            } else {
                return param
            }
        };

        let zzz = {'i': 0};
        zzz.sep = ' | ';
        zzz.color_critical = 'orange';

        systolic['x'].forEach(function() {
            main = {};
            main.sep = ' | ';
            main.color_critical = 'orange'; //'rgb(255, 0, 0)';
            main.fillColor = '#FFFFFF';
            zzz.fillColor = '#FFFFFF';
            main.data = {};
            zzz.data = {};
            zzz.sys = systolic.y[i];
            zzz.dia = diastolic.y[i];
            zzz.line_width = 2;
            main.line_color = 'orange';
            main.sys = systolic.y[i];
            main.dia = diastolic.y[i];
            main.line_width = 2;
            main.line_color = 'orange';

            if (main.sys > constants.max_systolic || main.sys < constants.min_systolic) {
                main.fill_color = main.color_critical;
                main.line_width = 0;
                main.line_color = 'brown'

                zzz.fill_color = main.color_critical;
                zzz.line_width = 0;
                zzz.line_color = 'brown'
            }

            main.marker = {
                enabled: true,
                fillColor: main.fill_color,
                lineWidth: main.line_width,
                lineColor: null
            };

            zzz.marker = {
                enabled: true,
                fillColor: main.fill_color,
                lineWidth: main.line_width,
                lineColor: null
            };

            if (i > 0) {
                sum = 0;
                arr = [];

                if (i > 1) {
                    for (j = 0; j < i; j++) {
                        arr.push(systolic.y[j])
                        sum += sum + systolic.y[j];
                    }
                }

                arr.forEach(function(item){
                    sum += sum + item;
                });

                averaged.push({'x': new Date(systolic.x[i]), 'y': (main.sys + systolic.y[i-1])/2, 'tooltip': 'SYS: ' + main.sys + main.sep + formatDate(systolic.x[i])});
            }

            main.data = {'x': new Date(systolic.x[i]), 'y': main.sys, 'tooltip': 'SYS: ' + main.sys + main.sep + formatDate(systolic.x[i]), 'marker': main.marker};
            data_sys.push(main.data);

            zzz.data = main.data

            main.data = {'x': new Date(diastolic.x[i]), 'y': main.dia, 'tooltip': 'DIA: ' + main.dia + main.sep + formatDate(diastolic.x[i])}
            data_dia.push(main.data);

            zzz.data = main.data
            i++;
        });
    </script>

</body>
</html>